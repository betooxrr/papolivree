<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Papo Livre - Painel Admin</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <style>
        body { background: #0b141a; color: #e9edef; font-family: sans-serif; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        .card { background: #202c33; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333; }
        h2 { color: #00a884; display: flex; align-items: center; gap: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; color: #8696a0; font-size: 12px; text-transform: uppercase; padding: 10px; }
        td { padding: 10px; border-top: 1px solid #333; font-size: 14px; }
        .btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-v { background: #00a884; color: white; }
        .btn-d { background: #ea0038; color: white; }
        .badge-v { color: #00d2ff; }
        .report-item { background: #3d1a1a; padding: 10px; border-radius: 5px; margin-bottom: 5px; border-left: 4px solid #ea0038; }
    </style>
</head>
<body>
    <div class="container">
        <h2><span class="material-symbols-outlined">shield_person</span> Dashboard Moderador</h2>
        
        <div class="card">
            <h3>Estatísticas</h3>
            <p>Usuários no Banco: <b id="u-count">0</b></p>
            <p>Mensagens Ativas: <b id="m-count">0</b></p>
            <button class="btn btn-d" onclick="window.clearChat()">LIMPAR TODO O CHAT</button>
        </div>

        <div class="card">
            <h3>Denúncias Ativas</h3>
            <div id="report-list">Nenhuma denúncia pendente.</div>
        </div>

        <div class="card">
            <h3>Gerenciar Usuários</h3>
            <table>
                <thead>
                    <tr><th>Nome</th><th>Status</th><th>Ações</th></tr>
                </thead>
                <tbody id="user-table"></tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBE-pjAqlu9uD5Ko6DjLRkwjxbHH0B80aY",
            authDomain: "ch4twebonline.firebaseapp.com",
            databaseURL: "https://ch4twebonline-default-rtdb.firebaseio.com/",
            projectId: "ch4twebonline",
            storageBucket: "ch4twebonline.firebasestorage.app",
            messagingSenderId: "196624139732",
            appId: "1:196624139732:web:51bf2ffd58fb950f1a0241"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Contadores
        onValue(ref(db, 'users'), s => {
            const users = s.val();
            document.getElementById('u-count').innerText = s.size || 0;
            const table = document.getElementById('user-table');
            table.innerHTML = '';
            if(users) {
                Object.keys(users).forEach(uid => {
                    const u = users[uid];
                    table.innerHTML += `
                        <tr>
                            <td>${u.name} ${u.verified ? '<span class="material-symbols-outlined badge-v">verified</span>' : ''}</td>
                            <td>${u.verified ? 'VIP' : 'Membro'}</td>
                            <td>
                                <button class="btn btn-v" onclick="window.verify('${uid}', ${u.verified || false})">Selo</button>
                                <button class="btn btn-d" onclick="window.delUser('${uid}')">Banir</button>
                            </td>
                        </tr>
                    `;
                });
            }
        });

        onValue(ref(db, 'messages'), s => document.getElementById('m-count').innerText = s.size || 0);

        // Denúncias
        onValue(ref(db, 'reports'), s => {
            const list = document.getElementById('report-list');
            list.innerHTML = '';
            if(s.exists()) {
                s.forEach(rep => {
                    const r = rep.val();
                    list.innerHTML += `
                        <div class="report-item">
                            ID Msg: ${r.msgId} | Autor: ${r.authorId} <br>
                            Denunciado por: ${r.reporterName} às ${r.time}
                            <button onclick="window.resolveReport('${rep.key}', '${r.msgId}')">Apagar Msg Denunciada</button>
                        </div>
                    `;
                });
            }
        });

        window.verify = (uid, current) => update(ref(db, `users/${uid}`), { verified: !current });
        window.delUser = (uid) => confirm("Apagar usuário do banco?") && remove(ref(db, `users/${uid}`));
        window.clearChat = () => confirm("APAGAR TUDO?") && remove(ref(db, 'messages'));
        window.resolveReport = (repKey, msgId) => {
            remove(ref(db, `messages/${msgId}`));
            remove(ref(db, `reports/${repKey}`));
        };
    </script>
</body>
                          </html>
